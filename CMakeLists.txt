# --------------------------------------------------------------------------
# General

CMAKE_MINIMUM_REQUIRED(VERSION 2.6.2)

PROJECT(st-base)

SET( STBASE_MAJOR_VERSION 1 )
SET( STBASE_MINOR_VERSION 0 )
SET( STBASE_PATCH_LEVEL 0 )
SET( STBASE_VERSION ${STBASE_MAJOR_VERSION}.${STBASE_MINOR_VERSION}.${STBASE_PATCH_LEVEL} )
#Indicates compatibility
SET( STBASE_SO_VERSION ${STBASE_MAJOR_VERSION}.${STBASE_MINOR_VERSION} )

# --------------------------------------------------------------------------
# Preproject variables.

IF(APPLE)
	SET(ST_APP_PATH "${ST_APP_NAME}.app")
ENDIF(APPLE)

# --------------------------------------------------------------------------
# Translations

IF(NOT ST_LOCALES_OUTPUT_PATH)
	IF(WIN32 AND NOT UNIX)
		SET ( ST_LOCALES_OUTPUT_PATH bin )
	ELSE(WIN32 AND NOT UNIX)
		IF(APPLE)
			SET ( ST_LOCALES_OUTPUT_PATH ${ST_APP_PATH}/Contents/MacOS )
		ELSE(APPLE) #UNIX
			SET ( ST_LOCALES_OUTPUT_PATH bin/${PROJECT_NAME}_stlocale )
		ENDIF(APPLE)
	ENDIF(WIN32 AND NOT UNIX)
ENDIF(NOT ST_LOCALES_OUTPUT_PATH)

IF(UNIX AND NOT APPLE)
	SET_PROPERTY(DIRECTORY APPEND PROPERTY COMPILE_DEFINITIONS "ST_LOCALE_PATH=\"${PROJECT_NAME}_stlocale\"")
ELSE(UNIX AND NOT APPLE)
	SET_PROPERTY(DIRECTORY APPEND PROPERTY COMPILE_DEFINITIONS "ST_LOCALE_PATH=\"\"")
ENDIF(UNIX AND NOT APPLE)

# --------------------------------------------------------------------------
# Installation dirs

IF(NOT STBASE_LIBRARY_OUTPUT_PATH)
	IF(WIN32 AND NOT UNIX)
		SET ( STBASE_LIBRARY_OUTPUT_PATH bin )
	ELSE(WIN32 AND NOT UNIX)
		IF(APPLE)
			SET ( STBASE_LIBRARY_OUTPUT_PATH ${STBASE_APP_PATH}/Contents/MacOS )
		ELSE(APPLE) #UNIX
			SET ( STBASE_LIBRARY_OUTPUT_PATH lib/${PROJECT_NAME} )
		ENDIF(APPLE)
	ENDIF(WIN32 AND NOT UNIX)
ENDIF(NOT STBASE_LIBRARY_OUTPUT_PATH)


# --------------------------------------------------------------------------
# Dependences

#Check for Qt
SET(QT_REQUIRED TRUE)
SET(QT_MIN_VERSION "4.2.2")
FIND_PACKAGE(Qt4)

IF(NOT QT4_FOUND)
  MESSAGE(SEND_ERROR "Qt ${QT_MIN_VERSION} or greater not found.  Please check the QT_QMAKE_EXECUTABLE variable.")
ELSE(NOT QT4_FOUND)

# --------------------------------------------------------------------------
# Miscelanea

OPTION(USE_PRINTKEEPER
  "Use printkeeper to check printer access"
  ON)

IF(USE_PRINTKEEPER)
		ADD_SUBDIRECTORY(printkeeper)
		SET_PROPERTY(DIRECTORY APPEND PROPERTY COMPILE_DEFINITIONS "USE_PRINTKEEPER" )
		INCLUDE_DIRECTORIES( ${st_printkeeper_SOURCE_DIR} )
		INCLUDE_DIRECTORIES( ${st_printkeeper_BINARY_DIR} )
		SET (PRINTKEEPER_LIBS st_printkeeper)
ENDIF(USE_PRINTKEEPER)

# --------------------------------------------------------------------------
# Calc Dependences

IF(ST_USE_IMAGELIB)
	SET (ST_USE_WIDGETS TRUE)
ENDIF(ST_USE_IMAGELIB)

IF(ST_USE_TICKETPRINTER)
	SET (ST_USE_WIDGETS TRUE)
	SET (ST_USE_OPENRPT TRUE)
	SET (ST_USE_SERIALPORT TRUE)
ENDIF(ST_USE_TICKETPRINTER)

IF(ST_USE_DBMANAG)
	SET (ST_USE_METADATA TRUE)
ENDIF(ST_USE_DBMANAG)

IF(ST_USE_METADATA)
	SET (ST_USE_DATABASE TRUE)
ENDIF(ST_USE_METADATA)

IF(ST_USE_DATABASE)
	SET (ST_USE_WIDGETS TRUE)
ENDIF(ST_USE_DATABASE)

IF(ST_USE_BURNING)
	SET (ST_USE_WIDGETS TRUE)
ENDIF(ST_USE_BURNING)

IF(ST_USE_DIGIKAM)
	SET (ST_USE_WIDGETS TRUE)
	SET (ST_USE_KDCRAW TRUE)
	SET (ST_USE_KEXIV2 TRUE)
ENDIF(ST_USE_DIGIKAM)

# --------------------------------------------------------------------------
# Sub Projects

ADD_SUBDIRECTORY(core)
IF(ST_USE_WIDGETS)
	ADD_SUBDIRECTORY(widgets)
ENDIF(ST_USE_WIDGETS)

IF(ST_USE_IMAGELIB)
	ADD_SUBDIRECTORY(imagelib)
ENDIF(ST_USE_IMAGELIB)

IF(ST_USE_KEXIV2)
	ADD_SUBDIRECTORY(kexiv2)
ENDIF(ST_USE_KEXIV2)

IF(ST_USE_KDCRAW)
	ADD_SUBDIRECTORY(kdcraw)
ENDIF(ST_USE_KDCRAW)

IF(ST_USE_DATABASE)
	ADD_SUBDIRECTORY(database)
ENDIF(ST_USE_DATABASE)

IF(ST_USE_METADATA)
	ADD_SUBDIRECTORY(metadata)
ENDIF(ST_USE_METADATA)

IF(ST_USE_DBMANAG)
	ADD_SUBDIRECTORY(dbmanag)
ENDIF(ST_USE_DBMANAG)

IF(ST_USE_OPENRPT)
	ADD_SUBDIRECTORY(openrpt)
ENDIF(ST_USE_OPENRPT)

IF(ST_USE_SERIALPORT)
	ADD_SUBDIRECTORY(serialport)
ENDIF(ST_USE_SERIALPORT)

IF(ST_USE_TICKETPRINTER)
	ADD_SUBDIRECTORY(ticketprinter)
ENDIF(ST_USE_TICKETPRINTER)

IF(ST_USE_PRINTKEEPER)
	ADD_SUBDIRECTORY(printkeeper)
ENDIF(ST_USE_PRINTKEEPER)

IF(ST_USE_BURNING)
	ADD_SUBDIRECTORY(burning)
ENDIF(ST_USE_BURNING)

IF(ST_USE_DIGIKAM)
	ADD_SUBDIRECTORY(digikam)
ENDIF(ST_USE_DIGIKAM)

ADD_SUBDIRECTORY(data)

ENDIF(NOT QT4_FOUND)
